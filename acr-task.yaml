version: v1.1.0
steps:
  - id: build-base-image-test
    build: >
      -f ./Dockerfile
      -t node-import:test
      .
  - id: validate-base-image
    cmd: node-import:test
    # only continues if node-import:test returns a non-zero code
  - id: az-login
    cmd: >
      az login --identity > /dev/null
    # login with the identity of the task
  - id: import-node-to-base-artifacts
    cmd: >
      az acr import 
      --name {{.Run.RegistryName}} 
      --source demo42upstream.azurecr.io/library/node:9-alpine 
      -t base-artifacts/node:9-alpine
      -t base-artifacts/node:9-alpine-$ID
      --force
  
